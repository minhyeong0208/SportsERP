<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>수입/지출 대장</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <!-- Admin CSS -->
    <link rel="stylesheet" href="/admin/css/admin.css">
    <!-- Vue.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.js"></script>
</head>

<body>
    <div id="income-expense">
        <!-- 헤더 컴포넌트 -->
        <admin-header></admin-header>

        <!-- 사이드바 컴포넌트 -->
        <admin-sidebar></admin-sidebar>

        <!-- Content -->
        <div id="content" class="container">
            <!-- Tabs -->
            <ul class="nav nav-tabs">
                <li class="nav-item">
                    <a class="nav-link" :class="{active: activeTab === 'daily'}" @click="activeTab = 'daily'">일별</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" :class="{active: activeTab === 'monthly'}" @click="activeTab = 'monthly'">월별</a>
                </li>
            </ul>

            <!-- 일별 수입/지출 대장 -->
            <div v-if="activeTab === 'daily'">
                <h3 class="my-4 text-center">일별 수입/지출 대장</h3>

                <!-- 날짜 선택 -->
                <div class="row mb-4">
                    <div class="col-md-4">
                        <label for="date" class="form-label">날짜 선택:</label>
                        <input type="date" v-model="selectedDate" id="date" class="form-control">
                    </div>
                    <div class="col-md-4 d-flex align-items-end">
                        <button @click="fetchDailyData" class="btn btn-primary w-100">데이터 조회</button>
                    </div>
                </div>

                <!-- 수입/지출 대장 테이블 -->
                <div class="table-responsive">
                    <table class="table table-bordered table-hover table-striped text-center">
                        <thead class="table-dark">
                            <tr>
                                <th colspan="3">수입 내역</th>
                                <th colspan="3">지출 내역</th>
                            </tr>
                            <tr>
                                <th>항목</th>
                                <th>적요</th>
                                <th>금액</th>
                                <th>항목</th>
                                <th>적요</th>
                                <th>금액</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="(row, index) in maxRows" :key="index">
                                <td>{{ row.income ? row.income.income_item : '' }}</td>
                                <td>{{ row.income ? row.income.income_purpose : '' }}</td>
                                <td>{{ row.income ? row.income.income_amount : '' }}</td>
                                <td>{{ row.expense ? row.expense.expense_item : '' }}</td>
                                <td>{{ row.expense ? row.expense.expense_purpose : '' }}</td>
                                <td>{{ row.expense ? row.expense.expense_amount : '' }}</td>
                            </tr>
                            <tr>
                                <th colspan="2" class="text-end">수입 계:</th>
                                <td>{{ totalIncome }}</td>
                                <th colspan="2" class="text-end">지출 계:</th>
                                <td>{{ totalExpense }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 월별 수입/지출 대장 -->
            <div v-if="activeTab === 'monthly'">
                <h3 class="my-4 text-center">월별 수입/지출 대장</h3>

                <!-- 월 선택 -->
                <div class="row mb-4">
                    <div class="col-md-4">
                        <label for="month" class="form-label">월 선택:</label>
                        <input type="month" v-model="selectedMonth" id="month" class="form-control">
                    </div>
                    <div class="col-md-4 d-flex align-items-end">
                        <button @click="fetchMonthlyData" class="btn btn-primary w-100">데이터 조회</button>
                    </div>
                    <div class="col-md-4 d-flex align-items-end">
        				<button @click="downloadPdf('monthly')" class="btn btn-success w-100">월별 PDF 다운로드</button>
    				</div>
                </div>

                <!-- 수입/지출 대장 테이블 -->
                <div class="table-responsive">
                    <table class="table table-bordered table-hover table-striped text-center">
                        <thead class="table-dark">
                            <tr>
                                <th colspan="2">수입 내역</th>
                                <th colspan="2">지출 내역</th>
                            </tr>
                            <tr>
                                <th>항목</th>
                                <th>금액</th>
                                <th>항목</th>
                                <th>금액</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="(row, index) in maxRowsMonthly" :key="index">
                                <td>{{ row.income ? row.income.income_item_name : '' }}</td>
                                <td>{{ row.income ? row.income.total_amount : '' }}</td>
                                <td>{{ row.expense ? row.expense.expense_item_name : '' }}</td>
                                <td>{{ row.expense ? row.expense.total_amount : '' }}</td>
                            </tr>
                            <tr>
                                <th class="text-end">수입 계:</th>
                                <td>{{ totalIncomeMonthly }}</td>
                                <th class="text-end">지출 계:</th>
                                <td>{{ totalExpenseMonthly }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- 외부 컴포넌트 파일 -->
    <script src="/admin/js/admin-header.js"></script>
    <script src="/admin/js/admin-sidebar.js"></script>
    <script src="/admin/js/statement.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
